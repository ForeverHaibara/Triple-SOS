<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <title>Sum of Square</title>
    <style>
    .collapse {
        transition-duration: 0;
    }
    .subcheckbox:not(:checked) {
        background-color: rgba(170, 160, 160, 0.464);
        border-color: rgba(170, 160, 160, 0.464);
    }
    </style>
    <!-- <script src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script> -->
    <script async src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<body>
<div id="frontpage" 
style="width: 100%;height: 100%;max-width: 1280px;max-height: 720px;position: absolute; display: flex; background: rgb(240,240,240);">
<div id="frontpageleft" style="width: 24%; margin-right: 0.5%; height: 100%; position: relative; 
    border-right: 2px solid rgb(220,220,220); background: rgb(255,255,255)">
    <!-- <div id="variables" style="width: 100%; height: 28px; text-align: left; display: inline-block;
    background: -webkit-linear-gradient(top, rgb(247,247,247),rgb(234,234,234));
    color: black; vertical-align: middle; border-bottom: 1px solid rgb(216,216,216); font-size: 19px;">
    &nbsp  ·&nbsp Variables</div> -->
    <div id="settings" style="width:100%; height: 30%;">
        <div id="settings_head" style="width: 100%; height: 28px; text-align: left; display: inline-block;
        background: -webkit-linear-gradient(top, rgb(247,247,247),rgb(234,234,234));
        color: black; vertical-align: middle; border-bottom: 1px solid rgb(216,216,216); font-size: 19px;">
        &nbsp  ·&nbsp Settings
        </div>
        <div id="setting_methods" style="margin-left: 10px; width:100%; height:200px;">
            <div class="form-check" style="margin-top: 5px">
                <input class="form-check-input" type="checkbox" value="" id="setting_method_use_StructuralSOS" checked>
                <label class="form-check-label" for="setting_method_use_StructuralSOS">Use Structural SOS</label>
                <input type="checkbox" class="collapse-toggle visually-hidden" id="setting_method_StructuralSOS_switch" data-bs-toggle="collapse" data-bs-target="#setting_method_StructuralSOS_menu" width="0">
                <label for="setting_method_StructuralSOS_switch" class="collapse-label">
                    <span class="me-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M5.646 4.646a.5.5 0 0 1 .708 0L10 8.293l3.646-3.647a.5.5 0 1 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708z"/>
                    </svg>
                    </span>
                </label>
                <div class="collapse" id="setting_method_StructuralSOS_menu" style="margin-left: 10px; margin-top: 3px; font-size: 15px;">
                    <input class="form-check-input subcheckbox" type="checkbox" value="" id="setting_method_StructuralSOS_real" checked>
                    <label class="form-check-label" for="setting_method_StructuralSOS_real">Real Numbers</label>
                </div>
            </div>
            <div class="form-check" style="margin-top: 5px">
                <input class="form-check-input" type="checkbox" value="" id="setting_method_use_LinearSOS" checked>
                <label class="form-check-label" for="setting_method_use_LinearSOS">Use Linear SOS</label>
            </div>
            <div class="form-check" style="margin-top: 5px">
                <input class="form-check-input" type="checkbox" value="" id="setting_method_use_SymmetricSOS" checked>
                <label class="form-check-label" for="setting_method_use_SymmetricSOS">Use Symmetric SOS</label>
            </div>
            <div class="form-check" style="margin-top: 5px">
                <input class="form-check-input" type="checkbox" value="" id="setting_method_use_SDPSOS" checked>
                <label class="form-check-label" for="setting_method_use_SDPSOS">Use SDP SOS</label>
                <input type="checkbox" class="collapse-toggle visually-hidden" id="setting_method_SDPSOS_switch" data-bs-toggle="collapse" data-bs-target="#setting_method_SDPSOS_menu" width="0">
                <label for="setting_method_SDPSOS_switch" class="collapse-label">
                    <span class="me-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M5.646 4.646a.5.5 0 0 1 .708 0L10 8.293l3.646-3.647a.5.5 0 1 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708z"/>
                    </svg>
                    </span>
                </label>
                <div class="collapse" id="setting_method_SDPSOS_menu" style="margin-left: 10px; margin-top: 3px; font-size: 15px;">
                    <label class="form-check-label" for="setting_method_SDPSOS_allow_numer">Accept Numerical Solution</label>
                    <input class="form-check-input subcheckbox" type="checkbox" value="" id="setting_method_SDPSOS_allow_numer">

                    <label class="form-check-label" for="setting_method_SDPSOS_reduced_decompose">Use Reduced Decomposition</label>
                    <input class="form-check-input subcheckbox" type="checkbox" value="" id="setting_method_SDPSOS_reduced_decompose">

                    <!-- <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                        <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
                        <label class="btn btn-outline-primary" for="btnradio1">Reduce</label>
                      
                        <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
                        <label class="btn btn-outline-primary" for="btnradio2">Full</label>
                    </div> -->
                </div>
            </div>
            <!-- <input type="checkbox" id="setting_method_use_StructuralSOS" checked="checked" style="font-size: 14px; margin-top: 10px; width: 80%" >&nbsp; Use Structural SOS</input>
            <input type="checkbox" id="setting_method_use_LinearSOS" checked="checked" style="font-size: 14px; margin-top: 10px; width: 80%" >&nbsp; Use Linear SOS</input>
            <input type="checkbox" id="setting_method_use_SymmetricSOS" checked="checked" style="font-size: 14px; margin-top: 10px; width: 80%" >&nbsp; Use Symmetric SOS</input> -->
        </div>
    </div>
    <div id="advertisement" style="position: absolute; left: 5px; bottom: 2%; text-align: left; vertical-align: baseline; font-size: 12px">
    <!-- <a href = "https://github.com/ForeverHaibara/Triple-SOS">GitHub</a> &nbsp; QQ 875413273 -->
        <a href="https://github.com/ForeverHaibara/Triple-SOS" target="_blank" style="margin-left: 5px; text-decoration: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="black" class="bi bi-github" viewBox="0 0 16 16">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
        </a>
        <a target="_blank" href="https://qm.qq.com/cgi-bin/qm/qr?k=8tjgp8Uo2WMqfOIGa7J68rvMMomUvl-s&jump_from=webapi&authKey=CO+CKU8hKPzSNMm1dvgGypGZE6H5TwGjaRxAW6XjtTQT2zy/tZCzvJv9yC4oH10G" style="margin-left: 5px; text-decoration: none;">
            <!-- <img border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="系数阵小课堂" title="系数阵小课堂"> -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(21,46,83)" class="bi bi-tencent-qq" viewBox="0 0 16 16">
                <path d="M6.048 3.323c.022.277-.13.523-.338.55-.21.026-.397-.176-.419-.453-.022-.277.13-.523.338-.55.21-.026.397.176.42.453Zm2.265-.24c-.603-.146-.894.256-.936.333-.027.048-.008.117.037.15.045.035.092.025.119-.003.361-.39.751-.172.829-.129l.011.007c.053.024.147.028.193-.098.023-.063.017-.11-.006-.142-.016-.023-.089-.08-.247-.118Z"/>
                <path fill-rule="evenodd" d="M11.727 6.719c0-.022.01-.375.01-.557 0-3.07-1.45-6.156-5.015-6.156-3.564 0-5.014 3.086-5.014 6.156 0 .182.01.535.01.557l-.72 1.795a25.85 25.85 0 0 0-.534 1.508c-.68 2.187-.46 3.093-.292 3.113.36.044 1.401-1.647 1.401-1.647 0 .979.504 2.256 1.594 3.179-.408.126-.907.319-1.228.556-.29.213-.253.43-.201.518.228.386 3.92.246 4.985.126 1.065.12 4.756.26 4.984-.126.052-.088.088-.305-.2-.518-.322-.237-.822-.43-1.23-.557 1.09-.922 1.594-2.2 1.594-3.178 0 0 1.041 1.69 1.401 1.647.168-.02.388-.926-.292-3.113a25.78 25.78 0 0 0-.534-1.508l-.72-1.795ZM9.773 5.53c-.13-.286-1.431-.605-3.042-.605h-.017c-1.611 0-2.913.319-3.042.605a.096.096 0 0 0-.01.04c0 .022.008.04.018.056.11.159 1.554.943 3.034.943h.017c1.48 0 2.924-.784 3.033-.943a.095.095 0 0 0 .008-.096Zm-4.32-.989c-.483.022-.896-.529-.922-1.229-.026-.7.344-1.286.828-1.308.483-.022.896.529.922 1.23.027.7-.344 1.286-.827 1.307Zm2.538 0c.483.022.896-.529.922-1.229.026-.7-.344-1.286-.827-1.308-.484-.022-.896.529-.923 1.23-.026.7.344 1.285.828 1.307ZM2.928 8.99a10.674 10.674 0 0 0-.097 2.284c.146 2.45 1.6 3.99 3.846 4.012h.091c2.246-.023 3.7-1.562 3.846-4.011.054-.9 0-1.663-.097-2.285-1.312.26-2.669.41-3.786.396h-.017c-.297.003-.611-.005-.937-.023v2.148c-1.106.154-2.21-.068-2.21-.068V9.107a22.93 22.93 0 0 1-.639-.117Z"/>
            </svg>
        </a>
        <a target="_blank" href="https://www.overleaf.com/read/hthkpznqdscq" style="margin-left: 5px; text-decoration: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(220,53,69)" class="bi bi-file-earmark-pdf-fill" viewBox="0 0 16 16">
                <path d="M5.523 12.424c.14-.082.293-.162.459-.238a7.878 7.878 0 0 1-.45.606c-.28.337-.498.516-.635.572a.266.266 0 0 1-.035.012.282.282 0 0 1-.026-.044c-.056-.11-.054-.216.04-.36.106-.165.319-.354.647-.548zm2.455-1.647c-.119.025-.237.05-.356.078a21.148 21.148 0 0 0 .5-1.05 12.045 12.045 0 0 0 .51.858c-.217.032-.436.07-.654.114zm2.525.939a3.881 3.881 0 0 1-.435-.41c.228.005.434.022.612.054.317.057.466.147.518.209a.095.095 0 0 1 .026.064.436.436 0 0 1-.06.2.307.307 0 0 1-.094.124.107.107 0 0 1-.069.015c-.09-.003-.258-.066-.498-.256zM8.278 6.97c-.04.244-.108.524-.2.829a4.86 4.86 0 0 1-.089-.346c-.076-.353-.087-.63-.046-.822.038-.177.11-.248.196-.283a.517.517 0 0 1 .145-.04c.013.03.028.092.032.198.005.122-.007.277-.038.465z"/>
                <path fill-rule="evenodd" d="M4 0h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm5.5 1.5v2a1 1 0 0 0 1 1h2l-3-3zM4.165 13.668c.09.18.23.343.438.419.207.075.412.04.58-.03.318-.13.635-.436.926-.786.333-.401.683-.927 1.021-1.51a11.651 11.651 0 0 1 1.997-.406c.3.383.61.713.91.95.28.22.603.403.934.417a.856.856 0 0 0 .51-.138c.155-.101.27-.247.354-.416.09-.181.145-.37.138-.563a.844.844 0 0 0-.2-.518c-.226-.27-.596-.4-.96-.465a5.76 5.76 0 0 0-1.335-.05 10.954 10.954 0 0 1-.98-1.686c.25-.66.437-1.284.52-1.794.036-.218.055-.426.048-.614a1.238 1.238 0 0 0-.127-.538.7.7 0 0 0-.477-.365c-.202-.043-.41 0-.601.077-.377.15-.576.47-.651.823-.073.34-.04.736.046 1.136.088.406.238.848.43 1.295a19.697 19.697 0 0 1-1.062 2.227 7.662 7.662 0 0 0-1.482.645c-.37.22-.699.48-.897.787-.21.326-.275.714-.08 1.103z"/>
            </svg>
        </a>
    </div>
</div>

<div id="frontpagemid" style="width: 50%; height: 100%; position: relative">
    <div id="inputs" style="width: 100%; height: 5%; margin-top: 1%">    
        <input type="text" id="input_poly" name="poly" style="border: 1px solid black; border-radius: 8px; 
        width: 99%; height: 100%; padding-left: 1%; font-size: small;" autocomplete="off"
        onkeyup="if(event.keyCode==13) {preprocessInput({findroot: 1});}"></input><br>
        <!-- <input type="submit" value="提交"> -->
    </div>
    <div id="centerscreen" style="width: 100%; height: 90%;margin-top: 1.5%; border-style: solid;border-color: gray;
    background: transparent; ">
        <div id="coeffs" style="width: 100%; height: 100%; position: absolute;">
        </div>
        <div id="polytools" style="position: absolute; bottom: 3%; left: 8px;">
            <div id="polytools_btns" style="margin-bottom: 5%">
                <button type="button" class="btn btn-outline-secondary" id="polytools_rotate" onclick="PolyTools('rotate');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                    </svg>
                  <span class="visually-hidden">Rotate</span>
                </button>
                <button type="button" class="btn btn-outline-secondary" id="polytools_rotate_reflect" onclick="PolyTools('rotate_reflect');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                    </svg>
                  <span class="visually-hidden">IRotate</span>
                </button>
                <button type="button" class="btn btn-outline-secondary" id="polytools_reflect" onclick="PolyTools('reflect');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"/>
                    </svg>
                  <span class="visually-hidden">Reflect</span>
                </button>
                <button type="button" class="btn btn-outline-secondary" id="polytools_factor" onclick="PolyTools('factor');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wrench-adjustable" viewBox="0 0 16 16">
                        <path d="M16 4.5a4.492 4.492 0 0 1-1.703 3.526L13 5l2.959-1.11c.027.2.041.403.041.61Z"/>
                        <path d="M11.5 9c.653 0 1.273-.139 1.833-.39L12 5.5 11 3l3.826-1.53A4.5 4.5 0 0 0 7.29 6.092l-6.116 5.096a2.583 2.583 0 1 0 3.638 3.638L9.908 8.71A4.49 4.49 0 0 0 11.5 9Zm-1.292-4.361-.596.893.809-.27a.25.25 0 0 1 .287.377l-.596.893.809-.27.158.475-1.5.5a.25.25 0 0 1-.287-.376l.596-.893-.809.27a.25.25 0 0 1-.287-.377l.596-.893-.809.27-.158-.475 1.5-.5a.25.25 0 0 1 .287.376ZM3 14a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/>
                    </svg>
                  <span class="visually-hidden">Sort</span>
                </button>
                <button type="button" class="btn btn-outline-secondary" id="polytools_latex_coeffs" onclick="PolyTools('latex_coeffs');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                    </svg>
                  <span class="visually-hidden">Copy</span>
                </button>
            </div>
        </div>
        <div id="rootsinfo" style="position: absolute; right: 7px; bottom: 3%; text-align: right; vertical-align: baseline; font-size: 12px">
        </div>
    </div>
</div>


<div id="frontpageright" style="width: 22%; height: 100%; margin-left: 1.5%;"> 
    <div id="heatmap_area" style="width: 90%; height: 40%; margin-left: 5%; position:relative;">
        <div id="heatmap" style="width: 100%; height: 100%; top: 0; left: 0; position:absolute;">
        </div>
        <!-- <button onclick="HeatmapScreenShot()" style="position:a">Take Screenshot</button> -->
        <button type="button" class="btn btn-outline-primary" id="heatmap_screenshot_button" onclick="HeatmapScreenShot();" style="bottom:0;right:0;position:absolute;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
                <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
            </svg>
          <span class="visually-hidden">Button</span>
        </button>
    </div>
    <button id="sumofsquare" 
    style="width: 90%; height: 5%; margin-left: 5%; margin-top: 2%; position: relative;
     font-size: small;
     background: linear-gradient(to bottom, rgb(247,247,247),rgb(221,221,221)); 
     border: 1px solid; border-color: rgba(200,200,200); color: rgb(60,60,60)"
     onmouseover="this.style.background = 'linear-gradient(to bottom, rgb(247,247,247),rgb(230,230,230))';
                    this.style.color = 'rgb(0,0,0)';" 
     onmouseleave="this.style.background = 'linear-gradient(to bottom, rgb(247,247,247),rgb(221,221,221))';
                    this.style.color = 'rgb(60,60,60)';" 
     onclick="SumOfSquare();"
    >
    Sum of Square
    </button>


    <div id="tangents" style="width: 96%; height: 20%; margin-left: 2%; margin-top: 4%">    
        <textarea id="input_tangents" style="border: 1px solid black; border-radius: 8px; font-family:'Times New Roman', Times, serif;
        width: 99%; height: 100%; padding-left: 1%; resize: none; font-size: small;" ></textarea>
    </div>
    <div id="outputs" style="width: 96%; height: 25%; margin-left: 2%; margin-top: 6%; ">  
        <div id="output_types" style="width: 99%; height: 20%;">
            <!-- <button id="output_showlatex" style="width:31%;height:100%;margin-left:2%;">LaTeX</button>
            <button id="output_showtxt" style="width:31%;height:100%">txt</button>
            <button id="output_showformatted" style="width:31%;height:100%">formatted</button> -->
            <div id="output_showlatex"  style="width:30%;height:99%;margin-left:3%;display:inline-block;text-align:center;padding-top: 2%;
            color:rgb(41,50,225);border-bottom: 2px solid blue;"
            onclick = "ChangeShowType('latex')" 
            onmouseover="ChangeShowTypeHover('latex',0)" onmouseleave="ChangeShowTypeHover('latex',1)">LaTeX</div>
            <div id="output_showtxt"  style="width:30%;height:99%;display:inline-block;text-align:center;padding-top: 2%;" 
            onclick = "ChangeShowType('txt')" 
            onmouseover="ChangeShowTypeHover('txt',0)" onmouseleave="ChangeShowTypeHover('txt',1)">txt</div>
            <div id="output_showformatted"  style="width:33%;height:99%;display:inline-block;text-align:center;padding-top: 2%;" 
            onclick = "ChangeShowType('formatted')"
            onmouseover="ChangeShowTypeHover('formatted',0)" onmouseleave="ChangeShowTypeHover('formatted',1)">formatted</div>
        </div>
        <textarea id="output_result" style="border: 1px solid black; border-radius: 8px; font-family:'Times New Roman', Times, serif;
        width: 99%; height: 82.5%; padding-left: 1%; margin-top: 3%; resize: none; font-size: small;" readonly="readonly"></textarea>
    </div>
</div>

<div id="shadow" hidden="hidden" style="width: 100%; height: 100%; position: absolute; top: 0px; left: 0px; background: rgba(0,0,0,0.59)">
    <div id="shadow_box" hidden="hidden" style="font-size: 15px; background-color: white; width: 80%; height: 80%; top: 10%; left: 10%; position: absolute;
    border: 2px solid blue; border-radius: 5px; text-align: center;"></div>
</div>
</div>
</body>

<script>
    // initialization
    var sos_poly = '';
    var sos_coeffs = [];
    var sos_deg = 0;
    var sos_results = {latex: '', txt: '', formatted: '', show: 'latex', displaying: 0};
    var sos_work = {num: 0};
    var sos_variables = {names: [], range: [[-5,0,5],[-5,0,5],[-5,0,5]]};


    // heatmap triangle
    var heatmap_grids = [];
    const heatmap_gridsize = 60;
    {
        let heatmap_view = document.getElementById('heatmap');
        const l = 98. / heatmap_gridsize; // length of each samll equilateral triangle 
        const ulx = (50 - l * heatmap_gridsize / 2), uly = (35 - 13 * heatmap_gridsize * l / 45);
        for (let i=0;i<=heatmap_gridsize;++i){
            for (let j=0;j<=heatmap_gridsize-i;++j){
                let heatmap_grid = document.createElement('div')
                heatmap_view.appendChild(heatmap_grid)
                let x = ulx + l*(i+j*2-1)/2, y = uly + l*i*13/15;
                heatmap_grid.setAttribute('style', 'position:absolute;left:'+x+'%;top:'+y+'%;'
                            +'height:'+l+'%'+';width:'+l+'%;background:white');
                heatmap_grids.push(heatmap_grid);
            }
        }
    }


    function CreateVariables(){
        const n = sos_variables.names.length; 
        for (let i = 0; i < n; ++i){
            let variable = document.createElement('div');
            document.getElementById('frontpageleft').appendChild(variable);
            variable.setAttribute('style', 'width: 100%; height: 10%;');
            variable.innerHTML = '<br>&nbsp;&nbsp;' + sos_variables.names[i];
            if (i % 2 === 1){
                variable.style.backgroundColor = 'rgb(245,245,245)';
            }else{
                variable.style.backgroundColor = 'rgb(255,255,255)';
            }
        }
    }
    CreateVariables();

    // functions

    function preprocessInput(kwargs){
        const input_poly = document.getElementById('input_poly').value.trim();        
        
        const parse_undefined = (x, y) => {return typeof(x) === 'undefined'? y: x;}
        const findroot = parse_undefined(kwargs['findroot'], 1);
        const sos = parse_undefined(kwargs['sos'], null);
        const factor = parse_undefined(kwargs['factor'], false);

        if (sos_poly === input_poly){
            if ((sos !== null) && (typeof(sos) !== 'undefined')){ 
                //输入没有变化, 但是要求配方
                sos();
            }
            return;
        }
        
        sos_poly = input_poly;
        axios.post('http://127.0.0.1:5000/process/preprocess',
            {poly: input_poly, factor: factor}
        ).then(res => {
            // after obtaining the return
            // n: degree of polynomial
            // txts: coefficients texts
            
            {
                if (res.data.factor.length > 0){
                    // If we have called factorization on the polynomial
                    document.getElementById("input_poly").value = res.data.factor;
                    sos_poly = res.data.factor.trim();
                }
                else if (res.data.cancel.length > 0){
                    // If the input is fraction, then substitude it with the denominator
                    document.getElementById("input_poly").value = res.data.cancel;
                    sos_poly = res.data.cancel.trim();
                }

            }

            // First render the coefficient triangle
            {
                let coeffs_view = document.getElementById('coeffs')
                // if (sos_deg != res.data.n){
                for (let i=sos_coeffs.length-1;i>=0;--i){
                    coeffs_view.removeChild(sos_coeffs.pop());
                }
                // }

                sos_deg = res.data.n ;
                let t = 0;
                const l = 100. / (1 + sos_deg); // length of each samll equilateral triangle 
                const ulx = (50 - l * sos_deg / 2), uly = (29 - 13 * sos_deg * l / 45);
                const fontsize = Math.max(11,Math.floor(28-1.5*sos_deg));
                const lengthscale = .28 * fontsize / 20.;
                const titleparser = (chr, deg) => { 
                    return deg <= 0? '': (deg==1? chr: chr+deg);
                }
                for (let i = 0; i <= sos_deg; ++i){
                    for (let j = 0; j <= i; ++j){
                        let coeff = document.createElement('p');
                        coeffs_view.appendChild(coeff);
                        coeff.innerHTML = res.data.txts[t];
                        let x =  (ulx + l*(2*i-j)/2 - res.data.txts[t].length * lengthscale - 2*Math.floor(res.data.txts[t].length/4)), 
                            y =  (uly + l*j*13/15);
                        coeff.setAttribute('style','position:absolute;left:'+x+'%;top:'+y+'%;font-size:'
                                        +fontsize+'px');
                        // when mouse hover on a monom, it shows hint like 'a5c' for a^5 * c
                        coeff.title = titleparser('a',sos_deg-i) + titleparser('b',i-j) + titleparser('c',j); 
                        coeff.onmouseover = () => {coeff.style.color = 'blue';}
                        if (res.data.txts[t] === '0'){
                            coeff.style.color = 'rgb(180,180,180)';
                            coeff.onmouseout  = () => {coeff.style.color = 'rgb(180,180,180)';}
                        }else{
                            coeff.style.color = 'black';
                            coeff.onmouseout  = () => {coeff.style.color = 'black';}
                        }
                        sos_coeffs.push(coeff)
                        ++t;
                    }
                }
            }
            
            // Next render the heatmap triangle
            {
                let t = 0;
                const color = res.data.heatmap;
                for (let i=0;i<=heatmap_gridsize;++i){
                    for (let j=0;j<=heatmap_gridsize-i;++j){
                        heatmap_grids[t].style.background = 'rgb('
                            +color[t][0]+','+color[t][1]+','+color[t][2]+')';
                        t += 1;
                    }
                }
            }

            // Next update the rootsinfo
            if (findroot == 1){
                document.getElementById("rootsinfo").innerHTML = '';
                axios.post('http://127.0.0.1:5000/process/rootangents',{}
                ).then(res => {
                    {
                        let str = res.data.rootsinfo;
                        // /n -> <br>
                        let i = 0;
                        while (i < str.length){
                            if (str[i] == '\n'){
                                str = str.slice(0, i) + ' <br> ' + str.slice(i+1, str.length);
                                i += 5;
                            }
                            ++i;
                        }
                        document.getElementById("rootsinfo").innerHTML = str;
                    }
                    {
                        let str = res.data.tangents;
                        document.getElementById("input_tangents").value = str.join('\n');
                    }

                    if (sos !== null){
                        // 同时还要进行配方
                        sos();
                    }
                }).catch(err => {
                    if (sos !== null){
                        sos_work.num -= 1;
                        if (sos_work.num == 0){
                            document.getElementById("sumofsquare").innerHTML = "Sum of Square";
                        }else{
                            document.getElementById("sumofsquare").innerHTML = "Sum of Square (" + sos_work.num + ")";
                        }
                    }
                });

            }
        }).catch(err => {
            if (sos !== null){
                sos_work.num -= 1;
                if (sos_work.num == 0){
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square";
                }else{
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square (" + sos_work.num + ")";
                }
            }
        }) ;
    };

    
    function SumOfSquare(){
        document.getElementById("sumofsquare").blur();
        sos_work.num += 1;
        document.getElementById("sumofsquare").innerHTML = "Sum of Square (" + sos_work.num + ")";
        
        function SOS_callback(){
            const input_poly = document.getElementById('input_poly').value;
            const tangents = document.getElementById('input_tangents').value;
            const methods = {
                StructuralSOS: document.getElementById("setting_method_use_StructuralSOS").checked,
                LinearSOS: document.getElementById("setting_method_use_LinearSOS").checked,
                SymmetricSOS: document.getElementById("setting_method_use_SymmetricSOS").checked,
                SDPSOS: document.getElementById("setting_method_use_SDPSOS").checked,
            }
            const configs = {
                StructuralSOS:{
                    real: document.getElementById("setting_method_StructuralSOS_real").checked,
                },
                SDPSOS: {
                    allow_numer: document.getElementById("setting_method_SDPSOS_allow_numer").checked,
                    decompose_method: document.getElementById("setting_method_SDPSOS_reduced_decompose").checked?'reduce':'raw',
                }
            }
            axios.post('http://127.0.0.1:5000/process/sos',{
                poly: input_poly, tangents: tangents, methods: methods, configs: configs}
            ).then(res=>{
                sos_results.latex = res.data.latex; 
                sos_results.txt   = res.data.txt;
                sos_results.formatted = res.data.formatted;
                document.getElementById('output_result').innerHTML = res.data[sos_results.show]

                const shadow_box = document.getElementById("shadow_box");
                let past;
                if ((past = shadow_box.firstChild)){
                    past.remove();
                }
                
                let str;
                if (!res.data.success){
                    str = '\\quad\\quad\\quad{\\rm Failed}\\quad\\quad\\quad';
                }else{
                    const text_length = sos_results.latex.length;
                    str = sos_results.latex.slice(2, text_length-2);
                    if (str.indexOf('aligned') < 0){ // no aligned environment
                        if (str.indexOf('\\\\') >= 0){
                            // 存在换行, 使用 \begin{aligned}
                            let i = 0;
                            while (i+1 < str.length){
                                if (str[i] == '\\' && str[i+1] == '\\'){
                                    str = str.slice(0, i+2) + ' & ' + str.slice(i+2, str.length);
                                    i += 2;        
                                }
                                ++i;
                            }
                            str = '\\begin{aligned}  \\  &' + str + '\\end{aligned}';
                        }
                    }
                }
                
                sos_work.num -= 1;
                if (sos_work.num == 0){
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square";
                }else{
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square (" + sos_work.num + ")";
                }

                let svg = window.MathJax.tex2svg(str).children[0];
                // shadow_box.style.height = '80%';
                shadow_box.appendChild(svg);
                svg.setAttribute('style', 'width: 95%; height: 90%; margin-top: 2%'); 
                shadow_box.hidden = "";
                document.getElementById("shadow").hidden = "";
                document.getElementById("input_poly").blur();
                document.getElementById("input_tangents").blur();
                sos_results.displaying = 1;
            }
            ).catch(err=>{
                sos_work.num -= 1;
                if (sos_work.num == 0){
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square";
                }else{
                    document.getElementById("sumofsquare").innerHTML = "Sum of Square (" + sos_work.num + ")";
                }
            });
        }
        preprocessInput({findroot: 1, sos: SOS_callback});
    }

    function ChangeShowType(x){
        if (sos_results.show != x){
            document.getElementById('output_show' + sos_results.show).style.color = 'black';
            document.getElementById('output_show' + sos_results.show).style.border = 'none';
            sos_results.show = x;
            document.getElementById('output_show' + x).style.color = 'rgb(41,50,225)';
            document.getElementById('output_show' + x).style.borderBottom = '2px solid blue';
            document.getElementById('output_result').innerHTML = sos_results[x];
        }else if (x == 'latex'){ // == sos_results.show
            document.getElementById("shadow_box").hidden = "";
            document.getElementById("shadow").hidden = "";
            sos_results.displaying = 1;
        }
    }


    function ChangeShowTypeHover(x, event){
        // event == 0: mouseenter    event == 1: mouseleave
        if (sos_results.show != x){
            if (event == 0){
                document.getElementById('output_show' + x).style.color = 'rgb(19,135,245)';
            }else{
                document.getElementById('output_show' + x).style.color = 'black';
            }
        }
    }


    function PolyTools(event){
        if ((event === 'rotate') || (event === 'rotate_reflect') || (event === 'reflect')){
            const input_poly_box = document.getElementById('input_poly');
            let txt = input_poly_box.value;
            let result = [];
            if (event === 'rotate'){
                for (let i = 0, n = txt.length; i < n; ++i){
                    if (txt[i] === 'a') result.push('b');
                    else if (txt[i] === 'b') result.push('c');
                    else if (txt[i] === 'c') result.push('a');
                    else result.push(txt[i]);
                }
            }else if (event === 'rotate_reflect'){
                for (let i = 0, n = txt.length; i < n; ++i){
                    if (txt[i] === 'a') result.push('c');
                    else if (txt[i] === 'b') result.push('a');
                    else if (txt[i] === 'c') result.push('b');
                    else result.push(txt[i]);
                }
            }else if (event === 'reflect'){
                for (let i = 0, n = txt.length; i < n; ++i){
                    if (txt[i] === 'b') result.push('a');
                    else if (txt[i] === 'a') result.push('b');
                    else result.push(txt[i]);
                }
            }
            input_poly_box.value = result.join("");
            preprocessInput({findroot: 1});
        }else if (event === 'factor'){
            sos_poly = ''; // reset
            preprocessInput({findroot: 1, factor: true});
        }else if (event === 'latex_coeffs'){
            axios.post('http://127.0.0.1:5000/process/latexcoeffs',
            {}
            ).then(res=>{
                    const str = res.data.coeffs;
                    // copy coeffs to clipboard
                    const el = document.createElement('textarea');
                    el.value = str;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);

                    // add a "copy" hint
                    const hint = document.createElement('div');
                    hint.innerHTML = 'Copied to clipboard!';
                    hint.setAttribute('style', 'position: absolute; top: 35%; left: 40%; width: 20%; height: 30px; background-color: rgba(68,68,68,0.5); display: flex; justify-content: center; align-items: center; font-size: 12px; color: rgb(255,255,255); border-radius: 10px;');
                    document.body.appendChild(hint);
                    setTimeout(function(){
                        document.body.removeChild(hint);
                    }, 1000);
                }
            );
        }
    }


    function HeatmapScreenShot() {
        console.log('hi');
        html2canvas(document.getElementById("heatmap"), {
            onrendered: function (canvas) {
                console.log('hasda');
                var link = document.createElement("a");
                console.log(link);
                link.download = "screenshot.png";
                link.href = canvas.toDataURL();
                link.click();
            },
        });
      }

    document.onkeyup = function(e) {
        // 兼容FF和IE和Opera
        var event = e || window.event;
        var key = event.which || event.keyCode || event.charCode;
        if ((key == 13 || key == 27) & sos_results.displaying == 1){
            // is displaying
            sos_results.displaying = 0; 
            // document.getElementById("shadow_box").hidden = "hidden";
            document.getElementById("shadow").hidden = "hidden";
        }
    };
</script>
</html>